package com.wipro.maverick_bank.service.impl;

import org.springframework.stereotype.Service;

import com.wipro.maverick_bank.dto.*;
import com.wipro.maverick_bank.entity.Role;
import com.wipro.maverick_bank.entity.User;
import com.wipro.maverick_bank.repository.RoleRepository;
import com.wipro.maverick_bank.repository.UserRepository;
import com.wipro.maverick_bank.service.UserService;

@Service
public class UserServiceImpl implements UserService {

	private final UserRepository userRepository;
	private final RoleRepository roleRepository;

	public UserServiceImpl(UserRepository userRepository, RoleRepository roleRepository) {
		this.userRepository = userRepository;
		this.roleRepository = roleRepository;
	}

	@Override
	public UserDTO createCustomer(UserDTO userDTO) {

		Role role = roleRepository.findByName("CUSTOMER").orElseThrow(() -> new RuntimeException("Role not found"));

		User user = new User();
		user.setUsername(userDTO.getUsername());
		user.setPassword(userDTO.getPassword());
		user.setRole(role);
		user.setActive(true);

		user = userRepository.save(user);

		return new UserDTO(user.getId(), user.getUsername(), role.getName());
	}

	@Override
	public UserDTO createEmployee(UserDTO userDTO) {

		Role role = roleRepository.findByName("EMPLOYEE").orElseThrow(() -> new RuntimeException("Role not found"));

		User user = new User();
		user.setUsername(userDTO.getUsername());
		user.setPassword(userDTO.getPassword());
		user.setRole(role);
		user.setActive(true);

		user = userRepository.save(user);

		return new UserDTO(user.getId(), user.getUsername(), role.getName());
	}

	@Override
	public UserDTO getUserById(Long userId) {

		User user = userRepository.findById(userId).orElseThrow(() -> new RuntimeException("User not found"));

		return new UserDTO(user.getId(), user.getUsername(), user.getRole().getName());
	}

	@Override
	public void deactivateUser(Long userId) {

		User user = userRepository.findById(userId).orElseThrow(() -> new RuntimeException("User not found"));

		user.setActive(false);
		userRepository.save(user);
	}
}